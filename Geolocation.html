<!DOCTYPE html>
<html>

<head>
    <title>Geolocation</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <style type="text/css">
        /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
        #map {
            height: 100%;
        }

        /* Optional: Makes the sample page fill the window. */
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .custom-map-control-button {
            background-color: #fff;
            border: 0;
            border-radius: 2px;
            box-shadow: 0 1px 4px -1px rgba(0, 0, 0, 0.3);
            margin: 10px;
            padding: 0 0.5em;
            font: 400 18px Roboto, Arial, sans-serif;
            overflow: hidden;
            height: 40px;
            cursor: pointer;
        }

        .custom-map-control-button:hover {
            background: #ebebeb;
        }
    </style>
    <script>

        // Note: This example requires that you consent to location sharing when
        // prompted by your browser. If you see the error "The Geolocation service
        // failed.", it means you probably did not give permission for the browser to
        // locate you.
        let map, infoWindow;

        function initMap() {
            //   geolocation();
            //   LatLng()  ;
            // basicEvent();  
            POIClickEvent();
        }
        function LatLng() {
            const mapOptions = {
                zoom: 8,
                center: { lat: -34.397, lng: 150.644 },
            };
            map = new google.maps.Map(document.getElementById("map"), mapOptions);
            const marker = new google.maps.Marker({
                // The below line is equivalent to writing:
                // position: new google.maps.LatLng(-34.397, 150.644)
                position: { lat: 34.397, lng: 150.644 },
                map: map,
            });
            // You can use a LatLng literal in place of a google.maps.LatLng object when
            // creating the Marker object. Once the Marker object is instantiated, its
            // position will be available as a google.maps.LatLng object. In this case,
            // we retrieve the marker's position using the
            // google.maps.LatLng.getPosition() method.
            const infowindow = new google.maps.InfoWindow({
                content: "<p>Marker Location:" + marker.getPosition() + "</p>",
            });
            google.maps.event.addListener(marker, "click", () => {
                infowindow.open(map, marker);
            });
        }
        function geolocation() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: -34.397, lng: 150.644 },
                zoom: 6,
            });
            infoWindow = new google.maps.InfoWindow();
            const locationButton = document.createElement("button");
            locationButton.textContent = "Pan to Current Location";
            locationButton.classList.add("custom-map-control-button");
            map.controls[google.maps.ControlPosition.TOP_CENTER].push(
                locationButton
            );
            locationButton.addEventListener("click", () => {
                // Try HTML5 geolocation.
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const pos = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                            };
                            infoWindow.setPosition(pos);
                            infoWindow.setContent("Location found.");
                            infoWindow.open(map);
                            map.setCenter(pos);//panTo
                        },
                        () => {
                            handleLocationError(true, infoWindow, map.getCenter());
                        }
                    );
                } else {
                    // Browser doesn't support Geolocation
                    handleLocationError(false, infoWindow, map.getCenter());
                }
            });
        }
        function basicEvent() {
            const myLatlng = { lat: -25.363, lng: 131.044 };
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 4,
                center: myLatlng,
            });
            const marker = new google.maps.Marker({
                position: myLatlng,
                map,
                title: "Click to zoom",
            });
            map.addListener("center_changed", () => {
                // 3 seconds after the center of the map has changed, pan back to the
                // marker.
                window.setTimeout(() => {
                    map.panTo(marker.getPosition());
                }, 3000);
            });
            marker.addListener("click", () => {
                map.setZoom(8);
                // map.setCenter(marker.getPosition());
            });
        }
        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(
                browserHasGeolocation
                    ? "Error: The Geolocation service failed."
                    : "Error: Your browser doesn't support geolocation."
            );
            infoWindow.open(map);
        }

        function POIClickEvent() {
            const origin = { lat: -33.871, lng: 151.197 };
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 18,
                center: origin,
            });
            new ClickEventHandler(map, origin);
        }

        function isIconMouseEvent(e) {
            return "placeId" in e;
        }

        class ClickEventHandler {
            constructor(map, origin) {
                this.origin = origin;
                this.map = map;
                this.directionsService = new google.maps.DirectionsService();
                this.directionsRenderer = new google.maps.DirectionsRenderer();
                this.directionsRenderer.setMap(map);
                this.placesService = new google.maps.places.PlacesService(map);
                this.infowindow = new google.maps.InfoWindow();
                this.infowindowContent = document.getElementById("infowindow-content");
                this.infowindow.setContent(this.infowindowContent);
                // Listen for clicks on the map.
                this.map.addListener("click", this.handleClick.bind(this));
            }
            handleClick(event) {
                console.log("You clicked on: " + event.latLng);

                // If the event has a placeId, use it.
                if (isIconMouseEvent(event)) {
                    console.log("You clicked on place:" + event.placeId);
                    // Calling e.stop() on the event prevents the default info window from
                    // showing.
                    // If you call stop here when there is no placeId you will prevent some
                    // other map click event handlers from receiving the event.
                    event.stop();

                    if (event.placeId) {
                        this.calculateAndDisplayRoute(event.placeId);
                        this.getPlaceInformation(event.placeId);
                    }
                }
            }
            calculateAndDisplayRoute(placeId) {
                const me = this;
                this.directionsService.route(
                    {
                        origin: this.origin,
                        destination: { placeId: placeId },
                        travelMode: google.maps.TravelMode.WALKING,
                    },
                    (response, status) => {
                        if (status === "OK") {
                            me.directionsRenderer.setDirections(response);
                        } else {
                            window.alert("Directions request failed due to " + status);
                        }
                    }
                );
            }
            getPlaceInformation(placeId) {
                const me = this;
                this.placesService.getDetails({ placeId: placeId }, (place, status) => {
                    if (
                        status === "OK" &&
                        place &&
                        place.geometry &&
                        place.geometry.location
                    ) {
                        me.infowindow.close();
                        me.infowindow.setPosition(place.geometry.location);
                        me.infowindowContent.children["place-icon"].src = place.icon;
                        me.infowindowContent.children["place-name"].textContent = place.name;
                        me.infowindowContent.children["place-id"].textContent = place.place_id;
                        me.infowindowContent.children["place-address"].textContent =
                            place.formatted_address;
                        me.infowindow.open(me.map);
                    }
                });
            }
        }
    </script>
</head>

<body>
    <div id="map"></div>
    <div id="infowindow-content">
        <img id="place-icon" src="" height="16" width="16" />
        <span id="place-name" class="title"></span><br />
        Place ID <span id="place-id"></span><br />
        <span id="place-address"></span>
    </div>

    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&callback=initMap&libraries=places&v=weekly"
        async></script>
</body>

</html>